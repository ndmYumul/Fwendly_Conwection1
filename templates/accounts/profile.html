{% extends 'base.html' %}
{% block content %}
<div class="card shadow-sm text-center">
  <div class="card-body" style="background-color: {{ profile.theme_color }}">
    {% if profile.cover_photo %}
      <img src="{{ profile.cover_photo.url }}" class="img-fluid mb-3" style="max-height:220px; object-fit:cover; width:100%;">
    {% endif %}
    {% if profile.profile_pic %}
      <img src="{{ profile.profile_pic.url }}" class="rounded-circle mb-2 profile-pic">
    {% endif %}
    <h3>{{ user.username }}</h3>
    {% if profile.status_message %}<p><em>"{{ profile.status_message }}"</em></p>{% endif %}
    <a class="btn btn-sm btn-secondary" href="{% url 'accounts:edit_profile' %}">Edit Profile</a>
  </div>
</div>

<div class="card mt-3">
  <div class="card-body">
    <h5>About</h5>
    <p><strong>Location</strong>: {{ profile.location|default:"—" }}</p>
    <p><strong>Interests</strong>: {{ profile.interests|default:"—" }}</p>
    <p>{{ profile.bio|default:"No bio yet." }}</p>
  </div>
</div>

<div class="card mt-3">
  <div class="card-body">
    <h5>Testimonials</h5>
    <ul class="list-group mb-3">
      {% for t in testimonials %}
        <li class="list-group-item">
          <strong>{{ t.author.username }}</strong>: {{ t.content }}
          <div class="float-end">
            <form method="post" action="{% url 'accounts:hide_testimonial' t.id %}" style="display:inline;">{% csrf_token %}
              <button class="btn btn-warning btn-sm">Hide</button>
            </form>
            <form method="post" action="{% url 'accounts:delete_testimonial' t.id %}" style="display:inline;">{% csrf_token %}
              <button class="btn btn-danger btn-sm">Delete</button>
            </form>
          </div>
        </li>
      {% empty %}
        <li class="list-group-item">No testimonials yet.</li>
      {% endfor %}
    </ul>

    <div class="accordion mb-3" id="hiddenTestimonialsAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingHidden">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHidden" aria-expanded="false" aria-controls="collapseHidden">
            View Hidden Testimonials ({{ hidden_testimonials.count }})
          </button>
        </h2>
        <div id="collapseHidden" class="accordion-collapse collapse" aria-labelledby="headingHidden" data-bs-parent="#hiddenTestimonialsAccordion">
          <div class="accordion-body">
            <ul class="list-group">
              {% for t in hidden_testimonials %}
                <li class="list-group-item">
                  <strong>{{ t.author.username }}</strong>: {{ t.content }}
                  <div class="float-end">
                    <form method="post" action="{% url 'accounts:unhide_testimonial' t.id %}" style="display:inline;">{% csrf_token %}
                      <button class="btn btn-success btn-sm">Unhide</button>
                    </form>
                    <form method="post" action="{% url 'accounts:delete_testimonial' t.id %}" style="display:inline;">{% csrf_token %}
                      <button class="btn btn-danger btn-sm">Delete</button>
                    </form>
                  </div>
                </li>
              {% empty %}
                <li class="list-group-item">No hidden testimonials.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<div class="card mt-3">
  <div class="card-body">
    <h5>Gallery</h5>
    <a class="btn btn-sm btn-success mb-2" href="{% url 'accounts:add_gallery_image' %}">+ Add Image</a>
    <div class="row">
      {% for img in gallery_images %}
        <div class="col-md-3 mb-3">
          <img src="{{ img.image.url }}" class="img-fluid" style="height:160px; object-fit:cover; width:100%;">
          <small class="text-muted d-block">{% if img.album %}Album: {{ img.album.name }}{% else %}No album{% endif %}</small>
        </div>
      {% empty %}
        <p class="text-muted">No images yet.</p>
      {% endfor %}
    </div>
  </div>
</div>

{% if profile.music %}
  <div class="mt-3">
    <audio {% if profile.music_autoplay %}autoplay muted{% endif %} controls>
      <source src="{{ profile.music.url }}" type="audio/mpeg">
      Your browser does not support audio.
    </audio>
  </div>
{% endif %}
{% endblock %}
